<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: main.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/** @module ScorecardView */

define(function(require) {
var Backbone = require('backbone'),
    Mustache = require('mustache'),
    ContentTemplate = require('text!streamhub-backbone/templates/Content.html'),
    ContentView = require('streamhub-backbone/views/ContentView'),
    sources = require('streamhub-backbone/const/sources'),
    _ = require('underscore');

/**
 * ScorecardView is a view that uses streamhub data to populate it's child elements.
 * It reads the bodyHtml of each item and trys to match the format
 * "score &lt;score1> &lt;score2> &lt;quarter text> &lt;datestamp>" where score1 and score2 are numbers for the
 * score boxes and anything after that (separated by a space) will be used for the quarter text,
 * before the last item, the datestamp, which is just used for cache busting streamhub.
 * @alias module:ScorecardView
 * @constructor
 * @param {Object.&lt;string, *>} opts A set of options to configure this instance.
 * @param {Object.&lt;string, *>} opts.sources A set of source specific options.
 * @param {string} opts.metaElement The selector of an element inside the bodyHtml of each content
 *        item that contains the meta data for this content item. 
 */
var ScorecardView = Backbone.View.extend(
{
	/**
	 * Initializes a ScorecardView, and is called by backbone during view construction.
	 * Binds to the collection's add event.
	 * @param {Object.&lt;string, *>} opts A set of options to configure this instance.
	 * @protected
	 */
    initialize: function (opts) {
        opts = opts || {};
        this._sourceOpts = opts.sources || {};
        this.lastEventId = 0;

        if (this.collection) {
	        this.collection.on('add', this._insertItem, this);
	        if (this.collection._initialized) {
	        	this.collection.each(function(item) {
	            	self._insertItem(item, self.collection);
	        	});
	        	this.render();
	        } else {
	        	this.collection.on('initialDataLoaded', this.render, this);
	        }
        }
    }
});

/**
 * Updates the scoreboard based on the bodyHtml of this content item, if its newer than the latest.
 * @param {Object} item A piece of content that was streamed to this view from Streamhub.
 * @param {Backbone.Collection} col A reference to the collection that this item was added to.
 * @return {Object} The $html element that was inserted.
 * @protected
 */
ScorecardView.prototype._insertItem = function (item, col) {
    var json = item.toJSON();
	if (json.event > this.lastEventId) {
		this.lastEventId = json.event;
	
	    var score1 = this.$el.find('.score1');
	    var score2 = this.$el.find('.score2');
	    var quarterEl = this.$el.find('.quarter');
	    //strip html tags
	    var text = $(document.createElement('div')).html(json.bodyHtml).text().trim();
		try {
			var parts = text.split(' ');
			if (parts.length >= 3 && parts.shift() == "score") {
				var s1 = parseInt(parts.shift());
				var s2 = parseInt(parts.shift());

				var self = this;
				parts.pop(); // popping "date time" from end, for cache busting
				var quarterText = parts.join(' ');

				this.$el.stop(true, true);
				this.$el.fadeOut(function() {
					score1.html(s1);
					score2.html(s2);
					if (quarterText.length != 0) { quarterEl.html(quarterText); }
					
					self.$el.fadeIn(function() {
						self.$el.css('opacity', '1');
					});
				});
			}
		} catch (ex) {
			return;
		}
	}	
    return;
};

return ScorecardView;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-ScorecardView.html">ScorecardView</a></li></ul></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.1.0</a> on Fri Feb 08 2013 20:13:15 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
